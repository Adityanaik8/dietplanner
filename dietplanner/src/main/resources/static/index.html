<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NutriGuide AI - Smart Diet Planner</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .logo {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .tagline {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .app-container {
            display: grid;
            grid-template-columns: 300px 1fr;
            min-height: 800px;
        }

        .sidebar {
            background: #f8f9fa;
            padding: 30px;
            border-right: 2px solid #e9ecef;
        }

        .nav-btn {
            display: block;
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            background: white;
            border: 2px solid #667eea;
            border-radius: 10px;
            color: #667eea;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
        }

        .nav-btn:hover {
            background: #667eea;
            color: white;
            transform: translateX(5px);
        }

        .nav-btn.active {
            background: #667eea;
            color: white;
        }

        .main-content {
            padding: 30px;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h2 {
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 600;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            border-color: #667eea;
            outline: none;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn:active {
            transform: translateY(-1px);
        }

        .result-box {
            background: #f8f9ff;
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }

        .result-box.active {
            display: block;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #667eea;
            font-size: 1.2rem;
        }

        .error {
            background: #ffeaea;
            color: #d32f2f;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border: 2px solid #ffcdd2;
        }

        .success {
            background: #e8f5e9;
            color: #2e7d32;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border: 2px solid #c8e6c9;
        }

        .food-item {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .food-item:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.1);
        }

        .meal-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 2px solid transparent;
            transition: all 0.3s;
        }

        .meal-card:hover {
            border-color: #667eea;
            transform: translateY(-5px);
        }

        .meal-time {
            color: #667eea;
            font-weight: bold;
            font-size: 1.3rem;
            margin-bottom: 10px;
        }

        .health-score {
            font-size: 2rem;
            font-weight: bold;
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            margin: 10px 0;
        }

        .score-excellent { background: #e8f5e9; color: #2e7d32; }
        .score-good { background: #fff3e0; color: #f57c00; }
        .score-fair { background: #fff8e1; color: #ff8f00; }
        .score-poor { background: #ffebee; color: #d32f2f; }

        footer {
            text-align: center;
            padding: 20px;
            color: #666;
            border-top: 2px solid #eee;
            margin-top: 30px;
        }

        @media (max-width: 768px) {
            .app-container {
                grid-template-columns: 1fr;
            }

            .sidebar {
                border-right: none;
                border-bottom: 2px solid #e9ecef;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <header>
        <div class="logo">üçé NutriGuide AI</div>
        <div class="tagline">Smart Indian Diet Planner - Eat Healthy, Live Better</div>
    </header>

    <div class="app-container">
        <div class="sidebar">
            <button class="nav-btn active" onclick="showPage('dashboard')">üè† Dashboard</button>
            <button class="nav-btn" onclick="showPage('profile')">üë§ My Profile</button>
            <button class="nav-btn" onclick="showPage('calories')">‚öñÔ∏è Calorie Calculator</button>
            <button class="nav-btn" onclick="showPage('meal-plan')">üìÖ Meal Planner</button>
            <button class="nav-btn" onclick="showPage('ingredients')">ü•ï My Ingredients</button>
            <button class="nav-btn" onclick="showPage('health-check')">üè• Health Check</button>
            <button class="nav-btn" onclick="showPage('foods')">üçΩÔ∏è Food Database</button>
        </div>

        <div class="main-content">
            <!-- Dashboard Page -->
            <div id="dashboard" class="page active">
                <h2>Welcome to NutriGuide AI</h2>
                <p>Your personal AI-powered diet assistant for Indian homemade meals.</p>

                <div class="quick-stats">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 30px 0;">
                        <div class="meal-card">
                            <div class="meal-time">Daily Calories</div>
                            <div id="dailyCalories" class="health-score score-good">--</div>
                        </div>
                        <div class="meal-card">
                            <div class="meal-time">Health Score</div>
                            <div id="healthScore" class="health-score score-fair">--</div>
                        </div>
                        <div class="meal-card">
                            <div class="meal-time">Meals Today</div>
                            <div style="font-size: 2.5rem; text-align: center; padding: 20px;">0/3</div>
                        </div>
                    </div>
                </div>

                <div class="quick-actions">
                    <h3>Quick Actions</h3>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-top: 20px;">
                        <button class="btn" onclick="showPage('meal-plan')">üìã Generate Today's Meal Plan</button>
                        <button class="btn" onclick="showPage('ingredients')">ü•ó What Can I Make?</button>
                        <button class="btn" onclick="showPage('health-check')">üè• Check Meal Health</button>
                    </div>
                </div>
            </div>

            <!-- Profile Page -->
            <div id="profile" class="page">
                <h2>My Profile</h2>
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" id="fullName" placeholder="Enter your name">
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label>Current Weight (kg)</label>
                        <input type="number" id="currentWeight" placeholder="e.g., 70">
                    </div>
                    <div class="form-group">
                        <label>Target Weight (kg)</label>
                        <input type="number" id="targetWeight" placeholder="e.g., 65">
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label>Height (cm)</label>
                        <input type="number" id="height" placeholder="e.g., 170">
                    </div>
                    <div class="form-group">
                        <label>Age</label>
                        <input type="number" id="age" placeholder="e.g., 25">
                    </div>
                </div>

                <div class="form-group">
                    <label>Diet Preference</label>
                    <select id="dietType">
                        <option value="VEG">Vegetarian</option>
                        <option value="NON_VEG">Non-Vegetarian</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Goal</label>
                    <select id="goal">
                        <option value="LOSE_WEIGHT">Lose Weight</option>
                        <option value="GAIN_WEIGHT">Gain Weight</option>
                        <option value="MAINTAIN">Maintain Weight</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Activity Level</label>
                    <select id="activityLevel">
                        <option value="SEDENTARY">Sedentary (Office job, little exercise)</option>
                        <option value="LIGHT">Light (Light exercise 1-3 days/week)</option>
                        <option value="ACTIVE">Active (Moderate exercise 3-5 days/week)</option>
                        <option value="VERY_ACTIVE">Very Active (Heavy exercise 6-7 days/week)</option>
                    </select>
                </div>

                <button class="btn" onclick="saveProfile()">üíæ Save Profile</button>
                <div id="profileResult" class="result-box"></div>
            </div>

            <!-- Calorie Calculator Page -->
            <div id="calories" class="page">
                <h2>Calorie Calculator</h2>
                <p>Calculate your daily calorie needs based on your goals.</p>

                <button class="btn" onclick="calculateCalories()">‚ö° Calculate My Calories</button>

                <div id="calorieResult" class="result-box">
                    <div class="loading">Calculating...</div>
                </div>
            </div>

            <!-- Meal Planner Page -->
            <div id="meal-plan" class="page">
                <h2>Daily Meal Planner</h2>
                <p>Get personalized meal plans for today.</p>

                <div class="form-group">
                    <label>Select Diet Type for Today</label>
                    <select id="todayDietType">
                        <option value="VEG">Vegetarian</option>
                        <option value="NON_VEG">Non-Vegetarian</option>
                    </select>
                </div>

                <button class="btn" onclick="generateMealPlan()">üçΩÔ∏è Generate Today's Meal Plan</button>

                <div id="mealPlanResult" class="result-box">
                    <div class="loading">Generating meal plan...</div>
                </div>
            </div>

            <!-- Ingredients Page -->
            <div id="ingredients" class="page">
                <h2>What's in Your Kitchen?</h2>
                <p>Enter ingredients you have, and we'll suggest meals.</p>

                <div class="form-group">
                    <label>Add Ingredients (comma separated)</label>
                    <textarea id="ingredientsList" rows="4" placeholder="e.g., rice, dal, potatoes, onions, tomatoes, chicken, eggs"></textarea>
                </div>

                <div class="form-group">
                    <label>Select Diet Type</label>
                    <select id="ingredientsDietType">
                        <option value="VEG">Vegetarian</option>
                        <option value="NON_VEG">Non-Vegetarian</option>
                    </select>
                </div>

                <button class="btn" onclick="addIngredients()">‚ûï Add Ingredients</button>
                <button class="btn" onclick="findMealsFromIngredients()">üîç Find Meals</button>

                <div id="ingredientsResult" class="result-box">
                    <div class="loading">Processing...</div>
                </div>
            </div>

            <!-- Health Check Page -->
            <div id="health-check" class="page">
                <h2>Meal Health Check</h2>
                <p>Check if your meal is healthy and get suggestions.</p>

                <div class="form-group">
                    <label>Describe your meal</label>
                    <textarea id="mealDescription" rows="3" placeholder="e.g., 2 rotis, dal, rice, vegetable sabzi"></textarea>
                </div>

                <div class="form-group">
                    <label>Meal Type</label>
                    <select id="checkMealType">
                        <option value="breakfast">Breakfast</option>
                        <option value="lunch">Lunch</option>
                        <option value="dinner">Dinner</option>
                        <option value="snack">Snack</option>
                    </select>
                </div>

                <button class="btn" onclick="checkMealHealth()">üè• Check Meal Health</button>

                <div id="healthCheckResult" class="result-box">
                    <div class="loading">Analyzing meal...</div>
                </div>
            </div>

            <!-- Foods Database Page -->
            <div id="foods" class="page">
                <h2>Food Database</h2>
                <p>Browse our Indian food database with nutrition information.</p>

                <div class="form-group">
                    <label>Filter by Type</label>
                    <select id="foodFilter" onchange="loadFoods()">
                        <option value="ALL">All Foods</option>
                        <option value="VEG">Vegetarian</option>
                        <option value="NON_VEG">Non-Vegetarian</option>
                    </select>
                </div>

                <div id="foodsList" class="result-box">
                    <div class="loading">Loading foods...</div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <p>¬© 2024 NutriGuide AI - Smart Diet Planning for Indian Homemade Meals</p>
        <p>Backend API running on Spring Boot | Frontend: HTML/CSS/JavaScript</p>
    </footer>
</div>

<script>
    let currentUser = null;

    function showPage(pageId) {
        document.querySelectorAll('.page').forEach(page => {
            page.classList.remove('active');
        });
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.classList.remove('active');
        });

        document.getElementById(pageId).classList.add('active');
        document.querySelector(`[onclick="showPage('${pageId}')"]`).classList.add('active');

        if (pageId === 'foods') {
            loadFoods();
        }
    }

    async function saveProfile() {
        const profileData = {
            username: "user_" + Date.now(),
            password: "password123",
            email: "user@example.com",
            fullName: document.getElementById('fullName').value,
            currentWeight: parseFloat(document.getElementById('currentWeight').value),
            targetWeight: parseFloat(document.getElementById('targetWeight').value),
            height: parseFloat(document.getElementById('height').value),
            age: parseInt(document.getElementById('age').value),
            dietType: document.getElementById('dietType').value,
            goal: document.getElementById('goal').value,
            activityLevel: document.getElementById('activityLevel').value
        };

        try {
            const response = await fetch('/api/users/register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(profileData)
            });

            const result = await response.json();
            const resultBox = document.getElementById('profileResult');

            if (result.success) {
                currentUser = { id: result.userId, ...profileData };
                localStorage.setItem('nutriguide_user', JSON.stringify(currentUser));

                resultBox.innerHTML = `
                    <div class="success">
                        <strong>‚úÖ Profile Saved Successfully!</strong><br>
                        User ID: ${result.userId}<br>
                        Daily calorie target will be calculated based on your profile.
                    </div>
                `;
                resultBox.classList.add('active');

                setTimeout(() => {
                    showPage('calories');
                }, 2000);
            } else {
                resultBox.innerHTML = `
                    <div class="error">
                        <strong>‚ùå Error:</strong> ${result.message}
                    </div>
                `;
                resultBox.classList.add('active');
            }
        } catch (error) {
            document.getElementById('profileResult').innerHTML = `
                <div class="error">
                    <strong>‚ùå Network Error:</strong> ${error.message}
                </div>
            `;
            document.getElementById('profileResult').classList.add('active');
        }
    }

    async function calculateCalories() {
        if (!currentUser) {
            alert('Please create a profile first!');
            showPage('profile');
            return;
        }

        const resultBox = document.getElementById('calorieResult');
        resultBox.innerHTML = '<div class="loading">Calculating your daily calorie needs...</div>';
        resultBox.classList.add('active');

        try {
            const response = await fetch(`/api/calories/calculate/${currentUser.id}`);
            const result = await response.json();

            let html = `
                <div class="success">
                    <h3>üìä Your Daily Nutrition Plan</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0;">
                        <div class="meal-card">
                            <div class="meal-time">BMR</div>
                            <div style="font-size: 1.5rem; text-align: center;">${result.bmr} kcal</div>
                        </div>
                        <div class="meal-card">
                            <div class="meal-time">Maintenance</div>
                            <div style="font-size: 1.5rem; text-align: center;">${result.maintenanceCalories} kcal</div>
                        </div>
                        <div class="meal-card">
                            <div class="meal-time">Target</div>
                            <div style="font-size: 1.5rem; text-align: center;">${result.targetCalories} kcal</div>
                        </div>
                    </div>

                    <h4>üçΩÔ∏è Macronutrient Split</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin: 15px 0;">
                        <div class="food-item">
                            <span>Protein</span>
                            <strong>${result.macros.proteinGrams}g</strong>
                        </div>
                        <div class="food-item">
                            <span>Carbs</span>
                            <strong>${result.macros.carbGrams}g</strong>
                        </div>
                        <div class="food-item">
                            <span>Fat</span>
                            <strong>${result.macros.fatGrams}g</strong>
                        </div>
                    </div>

                    <div class="success" style="margin-top: 15px;">
                        <strong>üí° Advice:</strong> ${result.advice}
                    </div>
                </div>
            `;

            resultBox.innerHTML = html;
        } catch (error) {
            resultBox.innerHTML = `
                <div class="error">
                    <strong>‚ùå Error:</strong> ${error.message}
                </div>
            `;
        }
    }

    async function generateMealPlan() {
        if (!currentUser) {
            alert('Please create a profile first!');
            showPage('profile');
            return;
        }

        const dietType = document.getElementById('todayDietType').value;
        const resultBox = document.getElementById('mealPlanResult');
        resultBox.innerHTML = '<div class="loading">Creating your personalized meal plan...</div>';
        resultBox.classList.add('active');

        try {
            const response = await fetch(`/api/meals/generate/${currentUser.id}?dietType=${dietType}`, {
                method: 'POST'
            });

            const result = await response.json();

            let html = `
                <div class="success">
                    <h3>üìÖ Today's Meal Plan (${dietType === 'VEG' ? 'Vegetarian' : 'Non-Vegetarian'})</h3>
                    <p><strong>üéØ Target Calories:</strong> ${result.targetCalories} kcal</p>
                    <p><strong>üí° Advice:</strong> ${result.advice}</p>
            `;

            for (const [mealTime, foods] of Object.entries(result.dailyMeals)) {
                if (foods.length > 0) {
                    html += `
                        <div class="meal-card">
                            <div class="meal-time">${mealTime.toUpperCase()}</div>
                            <div style="margin: 10px 0;">
                    `;

                    foods.forEach(food => {
                        html += `
                            <div class="food-item">
                                <span>${food.name}</span>
                                <span>${food.calories} kcal</span>
                            </div>
                        `;
                    });

                    html += `
                            </div>
                        </div>
                    `;
                }
            }

            html += `
                    <h4>üìä Total Nutrition</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; margin: 15px 0;">
                        <div class="food-item">
                            <span>Calories</span>
                            <strong>${Math.round(result.totalNutrition.calories)}</strong>
                        </div>
                        <div class="food-item">
                            <span>Protein</span>
                            <strong>${Math.round(result.totalNutrition.protein)}g</strong>
                        </div>
                        <div class="food-item">
                            <span>Carbs</span>
                            <strong>${Math.round(result.totalNutrition.carbs)}g</strong>
                        </div>
                        <div class="food-item">
                            <span>Fat</span>
                            <strong>${Math.round(result.totalNutrition.fat)}g</strong>
                        </div>
                    </div>
                </div>
            `;

            resultBox.innerHTML = html;
        } catch (error) {
            resultBox.innerHTML = `
                <div class="error">
                    <strong>‚ùå Error:</strong> ${error.message}
                </div>
            `;
        }
    }

    async function addIngredients() {
        if (!currentUser) {
            alert('Please create a profile first!');
            showPage('profile');
            return;
        }

        const ingredientsText = document.getElementById('ingredientsList').value;
        const ingredients = ingredientsText.split(',').map(item => {
            const trimmed = item.trim().toLowerCase();
            return {
                name: trimmed,
                quantity: 1,
                unit: 'piece'
            };
        }).filter(item => item.name.length > 0);

        try {
            const response = await fetch(`/api/ingredients/add/${currentUser.id}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(ingredients)
            });

            const result = await response.json();
            const resultBox = document.getElementById('ingredientsResult');

            resultBox.innerHTML = `
                <div class="success">
                    <strong>‚úÖ ${result.count} ingredients saved!</strong>
                    <p>You can now find meals using these ingredients.</p>
                </div>
            `;
            resultBox.classList.add('active');
        } catch (error) {
            document.getElementById('ingredientsResult').innerHTML = `
                <div class="error">
                    <strong>‚ùå Error:</strong> ${error.message}
                </div>
            `;
            document.getElementById('ingredientsResult').classList.add('active');
        }
    }

    async function findMealsFromIngredients() {
        if (!currentUser) {
            alert('Please create a profile first!');
            showPage('profile');
            return;
        }

        const dietType = document.getElementById('ingredientsDietType').value;
        const resultBox = document.getElementById('ingredientsResult');
        resultBox.innerHTML = '<div class="loading">Finding meals from your ingredients...</div>';
        resultBox.classList.add('active');

        try {
            const response = await fetch(`/api/ingredients/find-meals/${currentUser.id}?dietType=${dietType}`, {
                method: 'POST'
            });

            const result = await response.json();

            let html = `
                <div class="success">
                    <h3>üçΩÔ∏è Meals You Can Make</h3>
                    <p><strong>Available Ingredients:</strong> ${result.availableIngredients.join(', ')}</p>
            `;

            let hasMeals = false;
            for (const [mealTime, foods] of Object.entries(result.suggestedMeals)) {
                if (foods.length > 0) {
                    hasMeals = true;
                    html += `
                        <div class="meal-card">
                            <div class="meal-time">${mealTime.toUpperCase()}</div>
                            <div style="margin: 10px 0;">
                    `;

                    foods.forEach(food => {
                        html += `
                            <div class="food-item">
                                <span>${food.name}</span>
                                <span>${food.calories} kcal</span>
                            </div>
                        `;
                    });

                    html += `
                            </div>
                        </div>
                    `;
                }
            }

            if (!hasMeals) {
                html += `<p class="error">No meals found with your ingredients. Try adding more ingredients.</p>`;
            }

            html += `
                    <h4>üìä Nutrition Score: ${Math.round(result.nutritionScore.completenessScore)}%</h4>
            `;

            if (result.missingNutrients.length > 0) {
                html += `
                    <div class="error" style="margin-top: 15px;">
                        <strong>‚ö†Ô∏è Missing Nutrients:</strong>
                        <ul style="margin-top: 10px; padding-left: 20px;">
                `;

                result.missingNutrients.forEach(nutrient => {
                    html += `<li>${nutrient}</li>`;
                });

                html += `
                        </ul>
                    </div>
                `;
            }

            if (result.shoppingSuggestions.length > 0) {
                html += `
                    <div class="success" style="margin-top: 15px;">
                        <strong>üõí Shopping Suggestions:</strong>
                        <ul style="margin-top: 10px; padding-left: 20px;">
                `;

                result.shoppingSuggestions.forEach(suggestion => {
                    html += `<li>${suggestion}</li>`;
                });

                html += `
                        </ul>
                    </div>
                `;
            }

            html += `</div>`;
            resultBox.innerHTML = html;
        } catch (error) {
            resultBox.innerHTML = `
                <div class="error">
                    <strong>‚ùå Error:</strong> ${error.message}
                </div>
            `;
        }
    }

    async function checkMealHealth() {
        const mealDesc = document.getElementById('mealDescription').value;
        const mealType = document.getElementById('checkMealType').value;

        if (!mealDesc.trim()) {
            alert('Please describe your meal!');
            return;
        }

        const resultBox = document.getElementById('healthCheckResult');
        resultBox.innerHTML = '<div class="loading">Analyzing your meal health...</div>';
        resultBox.classList.add('active');

        const mockFoods = [
            { name: "Roti", calories: 70, protein: 3, carbs: 15, fat: 2 },
            { name: "Dal", calories: 150, protein: 8, carbs: 25, fat: 4 },
            { name: "Vegetable Sabzi", calories: 80, protein: 3, carbs: 10, fat: 4 }
        ];

        try {
            const response = await fetch(`/api/health/analyze-meal?mealType=${mealType}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(mockFoods)
            });

            const result = await response.json();

            let scoreClass = 'score-fair';
            if (result.healthScore >= 90) scoreClass = 'score-excellent';
            else if (result.healthScore >= 80) scoreClass = 'score-good';
            else if (result.healthScore >= 60) scoreClass = 'score-fair';
            else scoreClass = 'score-poor';

            let html = `
                <div class="success">
                    <h3>üè• Meal Health Analysis</h3>
                    <div class="health-score ${scoreClass}" style="margin: 20px auto; max-width: 300px;">
                        ${result.healthScore}/100
                        <div style="font-size: 1rem;">${result.healthStatus}</div>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin: 20px 0;">
                        <div class="food-item">
                            <span>Calories</span>
                            <strong>${result.totalCalories}</strong>
                        </div>
                        <div class="food-item">
                            <span>Protein</span>
                            <strong>${result.totalProtein}g</strong>
                        </div>
                        <div class="food-item">
                            <span>Carbs</span>
                            <strong>${result.totalCarbs}g</strong>
                        </div>
                        <div class="food-item">
                            <span>Fat</span>
                            <strong>${result.totalFat}g</strong>
                        </div>
                    </div>

                    <h4>üí° Health Tips</h4>
                    <div class="success">
                        <ul style="padding-left: 20px;">
            `;

            result.healthTips.forEach(tip => {
                html += `<li>${tip}</li>`;
            });

            html += `
                        </ul>
                    </div>

                    <div style="margin-top: 20px;">
                        <strong>Meal Type:</strong> ${mealType.toUpperCase()}<br>
                        <strong>Foods:</strong> ${result.foodNames.join(', ')}
                    </div>
                </div>
            `;

            resultBox.innerHTML = html;
        } catch (error) {
            resultBox.innerHTML = `
                <div class="error">
                    <strong>‚ùå Error:</strong> ${error.message}
                </div>
            `;
        }
    }

    async function loadFoods() {
        const filter = document.getElementById('foodFilter').value;
        const resultBox = document.getElementById('foodsList');
        resultBox.innerHTML = '<div class="loading">Loading food database...</div>';
        resultBox.classList.add('active');

        try {
            const url = filter === 'ALL' ? '/api/meals/foods' : `/api/meals/foods/${filter}`;
            const response = await fetch(url);
            const foods = await response.json();

            let html = `
                <div class="success">
                    <h3>üçé Food Database (${foods.length} items)</h3>
                    <div style="margin-top: 20px;">
            `;

            foods.forEach(food => {
                html += `
                    <div class="food-item">
                        <div>
                            <strong>${food.name}</strong><br>
                            <small>Type: ${food.foodType} | Category: ${food.category} | Meal: ${food.mealTime}</small>
                        </div>
                        <div style="text-align: right;">
                            <div>${food.calories} kcal</div>
                            <small>P:${food.protein}g C:${food.carbs}g F:${food.fat}g</small>
                        </div>
                    </div>
                `;
            });

            html += `
                    </div>
                </div>
            `;

            resultBox.innerHTML = html;
        } catch (error) {
            resultBox.innerHTML = `
                <div class="error">
                    <strong>‚ùå Error:</strong> ${error.message}
                </div>
            `;
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        const savedUser = localStorage.getItem('nutriguide_user');
        if (savedUser) {
            currentUser = JSON.parse(savedUser);
            document.getElementById('fullName').value = currentUser.fullName || '';
            document.getElementById('currentWeight').value = currentUser.currentWeight || '';
            document.getElementById('targetWeight').value = currentUser.targetWeight || '';
            document.getElementById('height').value = currentUser.height || '';
            document.getElementById('age').value = currentUser.age || '';
            document.getElementById('dietType').value = currentUser.dietType || 'VEG';
            document.getElementById('goal').value = currentUser.goal || 'LOSE_WEIGHT';
            document.getElementById('activityLevel').value = currentUser.activityLevel || 'SEDENTARY';
        }
    });
</script>
</body>
</html>